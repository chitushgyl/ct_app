<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<!-- windows phone 点击无高光 -->
		<meta name="misapplication-tap-highlight" content="no" />
		<!-- 删除默认的苹果工具栏和菜单栏 -->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.min.css">
		<!-- fonticon -->
		<link rel="stylesheet" type="text/css" href="../fonts/iconfont.css" />
		<!-- 通用样式 -->
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<!-- login -->
		<link rel="stylesheet" type="text/css" href="css/login.css" />

		<style type="text/css">
			{
					{
						{
						input {
							-webkit-user-select: auto !important;
							-moz-user-select:auto  !important;
							-o-user-select:auto  !important;
							user-select:auto  !important;
						}
					}
				}
			}
			.btnactive{
				font-size:16px !important;
				padding: 9px 50px;
				border: 1px solid #58A6FF;
				background: #58A6FF;
				color: #FFFFFF;
				border-radius: 5px;
				display: block;
			}
			.mui-popup-button:after {
				width: 0 !important;
			}
			/*modal*/
			.login_content{
				background-color: #fff;
				width:94%;
				margin-left:3%;
				height:110px;
				display:flex;
				flex-direction: row;
				margin-top:20px;
			}
			.login_content_one{
				width:10%;
				display:flex;
				justify-content: center;
				align-items: center;
				flex-direction:column;
			}
			.login_content_one img{
				width:18px;
				height:18px;
			}
			.login_content_two{
				width:70%;
			}
			.login_content_two1{
				font-size:18px;
				color:#666;
				height:50px;
				line-height: 50px;
			}
			.login_content_two2{
				font-size:12px;
				color:#666;
				height:20px;
				line-height: 20px;
				color:#0088f4;
			}
			.login_content_two3{
				font-size:10px;
				color:#666;
				height:25px;
				line-height: 25px;
				color:#d2d2d2;
			}
			.login_content_three{
				width:25%;
				display:flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
			}			
			.login_content_three img{
				width:100%;
			}
			
			.shadowbutton{
				position:absolute;
				right:0;
				top:11px;
				z-index:9999!important;
			}
			
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
<!-- 			<a class="mui-action-back mui-pull-left" id="return">
				<img src="../images/user/topbackarr.png" style="width: 20px;">
			</a> -->
		</header>
		<div class="mui-content" id="bottomx">
			<!-- 赤途冷链 -->
			<div class="loginTitle">
				<p class="font23 color_1d" id="titletip">欢迎登录赤途</p>
				<p id="tipText" class="font12 color_85">验证码已发送至<span id="tiPhone"></span></p>
			</div>
			<!-- 表单 -->

			<div class="mui-input-group">
				<!-- 手机号 -->
				<div class="mui-input-row phone_input">
					<!-- <label><img src="../images/login/new_login_phone.png" /></label> -->
					<input type="tel" class="font14" id="phone" maxlength="11" type="number" pattern="[0-9]*"  placeholder="请输入手机号" style="color: #1D2026;padding-left:0;" />
					<img src="../images/login/white.png" class="clear" onclick="clearall()" width="20px" height="20px" id="clear" />
					<!-- <button type="button" id="submit"  class="mui-btn-block font-write-color mui-btn-login shadowbutton">发送验证码</button> -->
				</div>				
				<div class="mui-input-row code_input" style="position:relative;">	
					<input type="text" class="font14" id="code" maxlength="4" placeholder="请输入验证码" style="color: #1D2026;height:40px;padding-left:0;" />		
					<button type="button" id="submit"  class="mui-btn mui-btn-primary mui-btn-outlined shadowbutton">发送验证码</button>
				</div>
				
				<!-- 密码登录区 -->
				<div class="mui-input-row pass-login">
					<!-- <label><img style="width: 16px; height: 20px;" src="../images/login/new_login_password.png" /></label> -->
					<input type="password" class="font14" id="passwrod" placeholder="请输入密码" style="color: #1D2026;margin:5px 0;padding-left:0;" />
					<span class="Eyes"><img style="display: none;" src="../images/login/white.png" width="20px" height="12px"
						 id="ico" onclick="xs()" title="显示密码" /></span>
				</div> 
				
				
				
				<button type="button" id="login_on" onclick="login_on()"  class="mui-btn-block font-write-color mui-btn-login onbutton">登录</button>


				<!-- 登录方式切换 -->
				<div class="switch-login color_1d login_type" style="display:flex;justify-content: space-between;">
					<div class="switch-item switch-pass">使用账号密码登录</div>
					<div class="switch-item switch-code active">使用验证码登录</div>
				</div>
				<div style="text-align: center;margin-top:10%;height:60px;line-height: 60px;font-size:20px;display:none;">
					<a href="#modal" id="change_login" style="color:#999;">点击选择身份&nbsp;&nbsp;<span id="change_login_name" style="color:#0088f4;font-weight: bold;"></span></a>
				</div>

			</div>
			<!-- 条款 -->
			<!-- <div ><button onclick="getregetcode()">按钮</button></div> -->
			<div class="pagebottom mui-text-center android-fixed" data-default='30'>
				<!-- <label><img src="../images/login/checked.png" class="radioimg"></label> -->
				<!-- <span class="font12 color_4d">登录即代表阅读并同意<span style="color: #58a6ff;">《服务条款》</span></span> -->
				<span class="font12 color_4d">登录即代表阅读并同意<span id="yhxy" style="color: #2972E9;">《用户协议》</span>和<span style="color: #2972E9;" id="yscz">《隐私政策》</span></span>
			</div>
		</div>

	</body>
	<!-- mui 框架 -->
	<script src="../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/vue-2.4.1.js" type="text/javascript"></script>
	<script src="../js/base64.min.js" type="text/javascript"></script>

	<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<!-- 通用js -->
	<script src="../js/common/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/common/fixed.js" type="text/javascript" charset="utf-8"></script>
	<!-- -->
	<script src="../js/config/request.js" type="text/javascript" charset="utf-8"></script>
	<!-- -->
	<script src="../js/controller/controller-account.js" type="text/javascript" charset="utf-8"></script>
	<!-- 登录js  -->
	<!-- <script src="../js/login.js" type="text/javascript" charset="utf-8"></script> -->
	<script type="text/javascript">
		// wed端的隐私政策
		mui('body').on('tap', '#yscz', function() {
			mui.openWindow({
				url: 'secret.html',
			});
		});

		mui('body').on('tap', '#yhxy', function() {
			mui.openWindow({
				url: 'agreement.html',
			});
		});

		var app_role = localStorage.getItem('app_role');
		if (!app_role) {
			// $('#modal').addClass('mui-active');
		} else {
			$('#change_login').hide();
		}

		$(document).on('click','.login_content',function(){
			var data = $(this).attr('data');
			localStorage.setItem('app_role',data)
			$('.login_content_one img').attr('src','../images/login/select1.png');
			$(this).find('.login_content_one img').attr('src','../images/login/select2.png');
			if (data == 1) {
				var role = '个人';
			} else if (data == 2) {
				var role = '企业';
			}
			$('#change_login_name').text(role);
			$('#modal').removeClass('mui-active');
		});


		// 登录方式状态 1 验证码登录 2 密码登录 3 邮箱登录
		var switchStatus = 1;
		var hadsendCode = false;

		
		/**
		 * @description: 密码登录
		 * @param {type} param_name
		 * @return {type}
		 */
		function passLogin() {
			// 获取手机号,正则验证手机号格式
			var phone = document.getElementById("phone").value;
			 if (!(/^1[3456789]\d{9}$/.test(phone))) {
			     mui.toast("请填写正确的手机号码");
			     return false;
			 }
			 mui.plusReady(function() {
			 	
				// 获取登陆密码
				var passwrod = document.getElementById("passwrod").value;
				var clientid = plus.push.getClientInfo().clientid;
				// 提交参数
				var data = {
					clientid: clientid,
					tel: phone,
					password: passwrod,
					type:'APP'
				};
				// 判断是否为空
				if (phone == '' || passwrod == '') {
					mui.toast('请填写手机号或密码');
					return false;
				}
				// 提交数据
				
				var url = request.account_login;
				console.log(url);
				request.PostInfo_new(url,data,function(res){
					console.log(88888888888888888888888888);
					console.log(JSON.stringify(res));
						localStorage.setItem('ftoken',res.ftoken);
						localStorage.setItem('dtoken',res.dtoken);
						
						console.log("ftoken:"+res.ftoken);
						console.log("dtoken:"+res.dtoken);
						
						refreshData();
						var index=plus.webview.getLaunchWebview();//获得初始窗口
						plus.webview.show(index);
						// user.setAllState(res, function() { // 储存本地用户信息
						// 	// 更新app的登陆信息
						// 	localStorage.setItem('ftoken',res.ftoken);
						// 	localStorage.setItem('dtoken',res.dtoken);
							
						// 	refreshData();

						// 	var index=plus.webview.getLaunchWebview();//获得初始窗口
						// 	plus.webview.show(index);
						// });						
				
						// mui.openWindow({             
						// 	id: 'index.html',
						// 	url: '../index.html',
						// 	waiting: {
						// 		autoShow: false
						// 	}
						// });
				
				},function(){});
				
				
				// account_login(data, function(data) {
				// 	// var data = response.data;
				// 	console.log(JSON.stringify(data));
				// 	user.setAllState(data.data, function() { // 储存本地用户信息
				// 		// 更新app的登陆信息
				// 		var level_id = data.data.level_id == 2 ? 2 : 1;
				// 		localStorage.setItem('app_role',level_id);
				// 		refreshData();
				// 		plus.webview.getWebviewById(plus.runtime.appid).evalJS('refreshData()');
				// 		plus.webview.getWebviewById('login').close();
				// 		// 返回上一页
				// 		mui.back();
				// 	});
				// });
			 })
		}		

		//切换账号密码登录
		mui('body').on('tap', '.switch-pass', function() {
			document.getElementById('titletip').innerHTML = "请输入账号及密码";
			document.getElementsByClassName('pass-login')[0].style.display = 'block';
			document.getElementsByClassName('code_input')[0].style.display = 'block';
			document.getElementById('submit').style.display = 'none';
			document.getElementById('code').style.display = 'none';
			
			$('clear').hide();
			// var www=document.getElementsByClassName("clear");//查找元素
			// www.style.right='10px';
			$('.code_input').hide();
			$('.phone_input').show();

			Array.prototype.forEach.call(this.parentNode.childNodes, function(value) {
				if (value.nodeType == 1) {
					value.classList.remove('active');
				}
			});
			this.classList.add('active');

			// 改变状态
			switchStatus = 2;

			// 终止验证码发送状态恢复初始状态
			// var codeEle = document.getElementById("sendCode");
			// account.closeCode(codeEle);
			// hadsendCode = false;
		});

		// 点击切换验证码登录
		mui('body').on('tap', '.switch-code', function() {
			document.getElementById('titletip').innerHTML = "欢迎登录赤途";
			document.getElementsByClassName('pass-login')[0].style.display = 'none';
			document.getElementById('submit').style.display = 'block';
			document.getElementById('code').style.display = 'block';
			$('clear').show();
			$('.phone_input').show();
			$('.code_input').show();
			Array.prototype.forEach.call(this.parentNode.childNodes, function(value) {
				if (value.nodeType == 1) {
					value.classList.remove('active');
				}
			});
			this.classList.add('active');

			switchStatus = 1;

		});


		$(document).on('click','.mui-action-back_',function(){
			$('#send_msg_modal').removeClass('mui-active');
		});		

		$(document).on('click','#xianshi',function(){
			$('#send_msg_modal').addClass('mui-active');
			document.getElementById('code').focus();
		});
		
		//发送验证码
		document.getElementById("submit").addEventListener("tap", function() {
			var c_out = click_one();
			if (!c_out) {
				console.log('time_in');
				return false;
			}
			// 判断登录方式
			if (switchStatus == 1 && !hadsendCode) { // 验证码登陆且还未发送验证码

				// 获取手机号,验证手机号格式
				var phone = document.getElementById("phone").value;
				if (!(/^1[345789]\d{9}$/.test(phone))) {
				    mui.toast("请填写正确的手机号码");
				    return false;
				}
				// codeELe
				var codeEle = document.getElementById("sendCode");
				
				// this.time = 60;
				// this.timer();
				var data = {
					tel : phone
				}
				
				  var time = 60;
				  var timer = null;
				  document.getElementById('submit').innerText = time + ' S后重新发送';
				  document.getElementById('submit').setAttribute('disabled', 'disabled');  // 禁用按钮
				  // document.getElementById('submit').setAttribute('class', 'disabled');   // 添加class 按钮样式变灰
				  timer = setInterval(function(){
					// 定时器到底了 兄弟们回家啦
					if(time == 1){
					  clearInterval(timer);       
					  document.getElementById('submit').innerText = '获取验证码';  
					  document.getElementById('submit').removeAttribute('disabled'); 
					  // document.getElementById('submit').removeAttribute('class');  
					}else{
					  time--;
					  document.getElementById('submit').innerText = time + ' S后重新发送';
					}
				  }, 1000)

				console.log("66666666666");
				var url = request.message_send
				request.PostInfo_new(url,data,function(res){
					
				},function(){});

			} else if(switchStatus == 2) { // 密码登录
				passLogin();
			}
		});
		
		/**
		 * @description: 验证码登录
		 * @param {type} param_name
		 * @return {type}
		 */
		function codeLogin() {
			// 获取手机号,验证手机号是否符合
			var phone = document.getElementById("phone").value;
			 if (!(/^1[3456789]\d{9}$/.test(phone))) {
				 mui.toast("请填写正确的手机号码");
				 return false;
			 }
			// 获取验证码

			// 提交参数
			mui.plusReady(function() {

				var codeVal = document.getElementById('code').value;
				// alert(codeVal);
				var clientid = plus.push.getClientInfo().clientid;
				var data = {
					tel:phone,
					clientid: clientid,
					code: codeVal,
					type:'APP'
				};
				// 判断是否为空
				if (phone == '' || codeVal == '') {
					mui.toast('请填写手机号或验证码');
					return false;
				}
				var url = request.login_tel_login;
				var login = 'login.html';
				// console.log(JSON.stringify(data));
				request.PostInfo_new(url,data,function(res){
					console.log(JSON.stringify(res));

						// user.setAllState(res, function() { // 储存本地用户信息
						// 	// 更新app的登陆信息
						// 	localStorage.setItem('ftoken',res.ftoken);
						// 	localStorage.setItem('dtoken',res.dtoken);
						// 	refreshData();
						// 	console.log(plus.webview.getWebviewById('login'));
						// 	// plus.webview.getWebviewById('login').close();
						// 	// plus.webview.currentWebview().close();
						// 	mui.back();
						// });	
											
						localStorage.setItem('ftoken',res.ftoken);
						localStorage.setItem('dtoken',res.dtoken);
						
						console.log("ftoken:"+res.ftoken);
						console.log("dtoken:"+res.dtoken);
						refreshData();
						var index=plus.webview.getLaunchWebview();//获得初始窗口
						plus.webview.show(index);					
											
						// user.setAllState(res, function() { // 储存本地用户信息
						// 	// 更新app的登陆信息
						// 	localStorage.setItem('ftoken',res.ftoken);
						// 	localStorage.setItem('dtoken',res.dtoken);
							
						// 	refreshData();
						// 	var index=plus.webview.getLaunchWebview();//获得初始窗口
						// 	plus.webview.show(index);
						// });
						// mui.openWindow({             
						// 	id: 'index.html',
						// 	url: '../index.html',
						// 	waiting: {
						// 		autoShow: false
						// 	}
						// });

				},function(){});

			})
		}
		
		
		//点击登录按钮
		function login_on(){
			if(switchStatus == 1){
				codeLogin();
				
			}else{ // 密码登录
				passLogin();
			}
		}
		

		var _back = mui.back;
		mui.back = function() {
			if (hadsendCode) {
				document.getElementById('titletip').innerHTML = "欢迎登录赤途";
				document.getElementById('tipText').style.display = "none";

				// 终止验证码发送状态恢复初始状态
				var codeEle = document.getElementById("sendCode");
				
				// codeEle.classList.remove("btnactive");
				// account.closeCode(codeEle);
				// hadsendCode = false;

				document.querySelector('.code-login').style.display = "none";
				document.querySelector('.timeinterval').style.display = "none";
				document.querySelector('.phone_input').style.display = "block";
				document.getElementById('submit').style.display = "block";
				document.querySelector('.login_type').style.display = "block";
				
				codeEle.classList.remove("btnactive");  // 移除存在的属性
				return false;

			}
			_back();
		}

		//phone有值时更换按钮样式
		document.getElementById('phone').addEventListener('input', function() {
			// document.activeElement.blur();
			if (this.value) {
				document.getElementById('submit').classList.add('hasphone');
				document.getElementById("clear").src = "../images/login/clear.png";
			} else {
				document.getElementById('submit').classList.remove('hasphone');
				document.getElementById("clear").src = "../images/login/white.png";
			}
		});		

		//密码有值时更换按钮样式
		document.getElementById('passwrod').addEventListener('input', function() {
			if (this.value) {
				document.getElementById("ico").style.display = "block";
				document.getElementById("ico").src = "../images/login/noeye.png";
			} else {
				document.getElementById("clear").src = "../images/login/white.png";
				document.getElementById("ico").style.display = "none";
			}
		});
		
		//防止底部图片被键盘顶起
		var h = document.body.offsetHeight;
		window.onresize = function() {

			if (document.body.offsetHeight < h) {
				document.getElementsByClassName('pagebottom')[0].style.display = 'none';
			} else {
				document.getElementsByClassName('pagebottom')[0].style.display = 'block';
			}
		}

		function xs() {
			//var a = document.getElementById("inp").value;
			var title = document.getElementById("ico").title;
			//alert();
			if (title == "隐藏密码") {
				document.getElementById("passwrod").type = "password";
				document.getElementById("ico").title = "显示密码";
				document.getElementById("ico").src = "../images/login/noeye.png";
			} else {
				document.getElementById("ico").title = "隐藏密码";
				document.getElementById("passwrod").type = "text";
				document.getElementById("ico").src = "../images/login/eyes.png";
			}
		}

		function clearall() {
			document.getElementById('phone').value = "";
			var value = document.getElementById('phone').value
			if (value == null || value == "" || value == "undefined" || value == undefined || value == "null") {
				document.getElementById('submit').classList.remove('hasphone');
				document.getElementById("clear").src = "../images/login/white.png";
			}
		}

		// document.getElementById('return').addEventListener('tap', function() {
		// 	var value = document.getElementById('code').value;
		// 	if (value.length > 0) {
		// 		document.getElementById('code').value = "";
		// 		document.getElementById('tel1').value = "";
		// 		document.getElementById('tel2').value = "";
		// 		document.getElementById('tel3').value = "";
		// 		document.getElementById('tel4').value = "";
		// 	}
		// });
		
		
	
		// function getregetcode() {
		// 	console.log(123);
		// 	var regetcodeval = document.getElementById("sendCode").innerText;
		// 	console.log(regetcodeval)
		// }
		
		// mui.plusReady(function() {
		// 	if(!plus.storage.getItem("logintoast")){
		// 		mui.confirm('请你务必谨慎阅读，充分理解“用户协议”和“隐私政策”各条款。您可阅读《隐私政策》和《用户协议》了解更多详细信息','提示', ['','我知道了',''], function(e) {
		// 			if (e.index == 1) {
		// 				// console.log("取消");
		// 				plus.storage.setItem("logintoast", "true");
		// 			} else {
		// 				// console.log("不取消");
		// 				plus.storage.setItem("logintoast", "true");
		// 			}
		// 		},'div');
		// 	}
		// })
		
		// document.getElementById("sendCode").addEventListener('tap', function() {
		// 	var regetcodeval = document.getElementById("sendCode").innerText;
		// 	if(regetcodeval == "重新获取"){
		// 		var phone = document.getElementById("phone").value;
		// 		// if (!(/^1[345789]\d{9}$/.test(phone))) {
		// 		//     mui.toast("请填写正确的手机号码");
		// 		//     return false;
		// 		// }
		// 		// codeELe
		// 		var codeEle = document.getElementById("sendCode");
		// 		account.sendCode(phone, codeEle, {
		// 			phone: phone
		// 		}, function() {
		// 			hadsendCode = true;
		// 			document.getElementById('code').focus();
		// 		});
		// 		codeEle.classList.remove("btnactive");
		// 	};
		// });

		setAutoHeight(function(h){
				$('.mui-content').css({"padding-top":(h)+"px"});
		},2)
		
		
		
		//监听向左滑动
		document.addEventListener("swiperight", function() {  
		
			clicked('../3pl_user/form.html');
		
		});
		
		//监听向左滑动  
		document.addEventListener("swipeleft", function() {  
		
			clicked('../3pl_user/form.html');
		
		});	
		
		
	</script>
</html>